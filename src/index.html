<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <title>AvatarQR</title>
  <!-- Importar Aframe -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

  <!-- Importar ARjs -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <!-- Importar Instascan para escanear códigos QR -->
  <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>

  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js"
      integrity="sha512-n8IpKWzDnBOcBhRlHirMZOUvEq2bLRMuJGjuVqbzUJwtTsgwOgK5aS0c1JA647XWYfqvXve8k3PtZdzpipFjgg=="
      crossorigin="anonymous"></script> -->

  <script src="https://cdn.jsdelivr.net/npm/fflate"></script>

  <!-- Importar Aframe Extras para que las animaciones de objetos 3D funcionen -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>

  <!-- Importar FBXLoader para cargar archivos con extensión FBX -->
  <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/FBXLoader.js"></script>

  <!-- Importar FBXLoader para cargar archivos con extensión GLB y GLTF -->
  <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>

  <!-- Importar FBXLoader para descargar archivos con extensión GLB y GLTF -->
  <script src="https://cdn.rawgit.com/mrdoob/three.js/r126/examples/js/exporters/GLTFExporter.js"></script>

  <script>
    AFRAME.registerComponent('handle-click-social-network', {

      init: function () {
        this.redirectSocialNetwork = function (e) {
          const socialNetwork = e.target.id;
          switch (socialNetwork) {
            case ('linkedin'):
              window.open('https://www.linkedin.com');
              break;
            case ('facebook'):
              window.open('https://www.facebook.com');
              break;
            case ('youtube'):
              window.open('https://www.youtube.com');
              break;
            case ('discord'):
              window.open('https://www.discord.com');
              break;
          }
        }

        this.el.addEventListener('click', this.redirectSocialNetwork);
      },

      remove: function () {
        this.el.removeEventListener('click', this.redirectSocialNetwork);
      }
    })
  </script>
  <script>
    AFRAME.registerComponent("modelo-gltf", {
      schema: {
        type: "model"
      },
      init: function () {
        this.model = null;
        this.loader = new THREE.GLTFLoader
      },
      update: function () {
        var e = this,
          o = this.el,
          t = this.data;
        var loaderAnimacion = new THREE.GLTFLoader();
        var loaderModelo = this.loader;
        t && (this.remove(),
          loaderAnimacion.load('../assets/dancing.glb', function (animacion) {
            loaderModelo.load(t, function (modelo) {

              modelo.scene.scale.set(2, 2, 2);

              for (let i = 0; i < animacion.animations[0].tracks.length; i++) {
                const str = animacion.animations[0].tracks[i].name;
                const newStr = str.replace('mixamorig', '');
                animacion.animations[0].tracks[i].name = newStr;
              }

              // Extraer las animaciones del modelo animado y guardarlas en una instancia de AnimationClip
              const nombreAnimacion = animacion.animations[0].name;
              const duracionAnimacion = animacion.animations[0].duration;
              const tracksAnimacion = animacion.animations[0].tracks;
              const animation = new THREE.AnimationClip(nombreAnimacion, duracionAnimacion, tracksAnimacion);

              // Agregar las animaciones al modelo
              modelo.animations[0] = animation;

              e.model = modelo.scene || modelo.scenes[0], e.model.animations = modelo.animations, o.setObject3D("mesh", e.model), o.emit("model-loaded", {
                format: "gltf",
                model: e.model
              })
            }, void 0, function (e) {
              var r = e && e.message ? e.message : "Failed to load glTF model";
              warn(r), o.emit("model-error", {
                format: "gltf",
                src: modelo
              })
            }
            )
          })
        )
      },
      remove: function () {
        this.model && this.el.removeObject3D("mesh")
      }
    });
  </script>
  <style>
    video {
      opacity: 1;
      transform: scaleX(1) !important;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <noscript>Necesita habilitar JavaScript para ejecutar esta aplicación.</noscript>
  <video id="preview"></video>
  <canvas id="canvas"></canvas>

  <a-scene id="scene" cursor="rayOrigin: mouse" arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    vr-mode-ui="enabled: false;">
    <a-marker type="pattern" preset="custom" url="../assets/Marker.patt" ar-tracking></a-marker>
  </a-scene>
  <script src="./index.js"></script>
  <script>

  </script>

</body>

</html>