<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <title>AvatarQR</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js"
    integrity="sha512-n8IpKWzDnBOcBhRlHirMZOUvEq2bLRMuJGjuVqbzUJwtTsgwOgK5aS0c1JA647XWYfqvXve8k3PtZdzpipFjgg=="
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/fflate"></script>
  <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/FBXLoader.js"></script>
  <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>


  <!-- FBXLoader -->
  <!-- <script src="https://cdn.rawgit.com/mrdoob/three.js/r128/examples/js/loaders/FBXLoader.js"></script> -->

  <script>
    AFRAME.registerComponent('handle-click-social-network', {

      init: function () {
        this.redirectSocialNetwork = function (e) {
          const socialNetwork = e.target.id;
          switch (socialNetwork) {
            case ('linkedin'):
              window.open('https://www.linkedin.com');
              break;
            case ('facebook'):
              window.open('https://www.facebook.com');
              break;
            case ('youtube'):
              window.open('https://www.youtube.com');
              break;
            case ('discord'):
              window.open('https://www.discord.com');
              break;
          }
        }

        this.el.addEventListener('click', this.redirectSocialNetwork);
      },

      remove: function () {
        this.el.removeEventListener('click', this.redirectSocialNetwork);
      }
    })
  </script>
  <script>
    AFRAME.registerComponent('handle-model-loaded', {

      schema: {
        model: { type: 'string' }
      },

      init: function () {
        const that = this;

        const loaderModelo = new THREE.GLTFLoader();

        const modeloGLB = `${that.data.model}`;

        loaderModelo.load(modeloGLB, function (gltf) {

          const scene = gltf.scene;
          const armature = scene.getObjectByName('Armature');
          let actual = armature;

          let bones = actual.children[0];

          // --------------------------------------------------------------------------
          // Cambiar nombre de los huesos y agregarle el string 'mixamorig:' al comienzo
          cambiarNombreHuesos(bones);

          function cambiarNombreHuesos(actual) {
            if (actual.type === 'Bone') {
              actual.name = 'mixamorig:' + actual.name;
              if (actual.children.length > 0) {
                actual.children.forEach(e => {
                  cambiarNombreHuesos(e);
                });
              }
              return;
            }
            return;
          }
          // --------------------------------------------------------------------------

          const fbxLoader = new THREE.FBXLoader();
          fbxLoader.load('../assets/dancing.fbx', function (fbx) {
            // Crear el objeto AnimationMixer y a침adir la animaci칩n al modelo GLB
            const mixer = new THREE.AnimationMixer(gltf.scene);
            const action = mixer.clipAction(fbx.animations[0]);
            action.play();
            console.log('La animaci칩n se est치 reproduciendo en la consola.');
          });
        });
      }
    });
  </script>
  <style>
    video {
      opacity: 1;
      transform: scaleX(1) !important;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <video id="preview"></video>
  <canvas id="canvas"></canvas>

  <a-scene id="scene" cursor="rayOrigin: mouse" arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    vr-mode-ui="enabled: false;">
    <a-marker type="pattern" preset="custom" url="../assets/Marker.patt" ar-tracking></a-marker>
  </a-scene>
  <script src="./index.js"></script>
  <script>

  </script>

</body>

</html>